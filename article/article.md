# Продвинутое использование форм в Django

## Введение

Хотя в настоящее время большой популярностью пользуется клиентский рендеринг веб-интерфейсов, Django с «батарейками» в комплекте предоставляет широкий функционал для server-side рендеринга.

В этой статье я хочу поговорить о подходах к рендерингу форм.

## Проблема

Для демонстрации будем использовать простую модель:

###### _models.py_

````python
class Customer(models.Model):
    name = models.CharField(max_length=50)
    address = models.CharField(max_length=200)
    cust_number = models.IntegerField(blank=False, null=False)
    city = models.CharField(max_length=50)
    state = models.CharField(max_length=50)
    zipcode = models.CharField(max_length=10)
````

Для работы с формами Django предоставляет модуль forms включающий мета классы, которые позволяют декларативно cгенерировать форму для нашей модели:

###### _forms.py_

```
class CustomerForm(forms.ModelForm):
    class Meta:
        model = Customer
        fields = '__all__'
```

Создадим простое представление для демонстрации получаемых форм:

###### _views.py_

```
class CustomerCreateView(CreateView):
    model = Customer
    form_class = CustomerForm
```

Добавим форму в шаблон html страницы:

###### _customer_form.html_

```python
{% extends 'base.html' %}

{% block content %}
  {{ form }}
{% endblock %}
```

Поздравляю! Нам потребовалось ровно 4 строчки кода чтобы отрендерить форму включающиую множество полей и одна строка, чтобы добавить ее в шаблон (не считаем создание конечной точки http). Но согласитесистесь, в текущем варинате форма смотрится крайне аскетично:

![1.PNG](assets/1.PNG)

Django еще не знает, что мы используем css-фреймфорк Bootstrap 5 (хотя вы можете использовать любой другой) для стилизации html страниц.

## Первое решение

Bootstrap предоставляет широкий набор классов и готовых снипетов форм для использования в шаблонах. Первое решение котрое приходит на ум: "Давайте добавим нужные элементы прямо в шаблон!".

В таком случае мы берем написание html кода формы на себя, используя сниппеты предоставляемые css библиотекой. Таким образом можно добиться безупречной стилизации формы, контролируя каждый элемент в отдельности. Но есть и недостатки такого подхода. Из одной строки вида: `{{ form }}`, форма разрастается до десятков и даже сотен строк. Мы вынуждены контролировать виджеты, лэйблы, строки подсказок, вывод ошибок и многе другое. При этом переиспользование и поддержка при таком подходе крайне затруднены, поскольку форма создается индивидуально, под конкретную реализацию.

Что то здесь не так, ведь на предыдущем этапе мы задействовали встроенные механизмы рендеринга форм Django, не будем от них отказываться!

## Второе решение

Мета классы форм в Django позволяют переопределить шаблоны используемые для рендеринга c помошью переменных класса вида template_name_* (например template_name_div или template_name_label в зависимотси от переопределяемого шаблона). Таким образом мы сможем отказаться от определения html кода каждой формы вручную в пользу переопределения многократно используемых шаблонов.

Поставляемые с фреймфорком шаблоны хранятся в следующей директории: `venv/Lib/site-packages/django/forms/templates/django/forms`.

Bootstrap использует верстку форм на основе div'ов поэтому за основу нового шаблона возьмем `forms/div.html`:

###### *div.html*

```
...
{% for field, errors in fields %}
  <div{% with classes=field.css_classes %}{% if classes %} class="{{ classes }}"{% endif %}{% endwith %}>
    {{ field.as_field_group }}
    {% if forloop.last %}
      {% for field in hidden_fields %}{{ field }}{% endfor %}
    {% endif %}
</div>
{% endfor %}
...
```

![2.PNG](assets/2.PNG)
